<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ZÂ Radio â€“Â LiveÂ Stream</title>

<style>
:root{
  --accent:#1db954;
  --bg1:#0e0e0e;
  --bg2:#232526;
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;
  background:linear-gradient(145deg,var(--bg1),var(--bg2));
  color:#f5f5f5;
  text-align:center;
  padding:1.2rem;
}
h1{font-size:2.6rem;color:var(--accent);letter-spacing:.5px;margin-bottom:.2em}
small{color:#aaa}
#cover{
  width:220px;height:220px;border-radius:8px;object-fit:cover;
  box-shadow:0 4px 16px rgba(0,0,0,.4);margin:1.3em 0 .8em;
}
audio{
  width:220px;height:40px;border:none;margin-bottom:1em;
  filter:drop-shadow(0 2px 4px rgba(0,0,0,.5));
}
.meta{font-size:1.05rem;margin-top:.3em}
#listeners{font-size:.9rem;color:#ccc;margin-top:.2em}
footer{margin-top:2.5rem;font-size:.8rem;color:#888}
a{color:var(--accent)}
</style>
</head>
<body>

<h1>ðŸŽµÂ ZÂ Radio</h1>
<small>MusiqueÂ 24Â /Â 7 â€“Â IcecastÂ Stream</small>

<img id="cover" src="https://dummyimage.com/600x600/1b1b1b/ffffff&text=Z+Radio" alt="Cover">

<audio id="player" controls preload="none">
  <source src="https://zradio.ddns.net:8443/stream" type="audio/mpeg">
  Votre navigateur ne supporte pas lâ€™audioÂ HTML5.
</audio>

<div id="title" class="meta">Titre inconnu</div>
<div id="listeners">AuditeursÂ :Â 0</div>

<footer>
  Â©Â 2025Â <span style="color:var(--accent)">ZÂ Radio</span> â€“Â Powered by
  <a href="https://icecast.org" target="_blank" rel="noopener">IcecastÂ 2</a>
</footer>

<script>
const statusURL  = "https://zradio.ddns.net:8443/status-json.xsl"; // HTTPS !
const player     = document.getElementById("player");
const coverImg   = document.getElementById("cover");
const titleEl    = document.getElementById("title");
const listenersEl= document.getElementById("listeners");
let lastTitle    = "";

async function fetchCover(query){
  try{
    const r = await fetch("https://itunes.apple.com/search?term="+encodeURIComponent(query)+"&limit=1&media=music");
    const j = await r.json();
    if(j.results && j.results[0]){
      const art = j.results[0].artworkUrl100.replace("100x100","600x600");
      coverImg.src = art;
      return;
    }
  }catch(e){}
  coverImg.src = "https://dummyimage.com/600x600/1b1b1b/ffffff&text=Z+Radio";
}

async function refresh(){
  try{
    const r = await fetch(statusURL,{cache:"no-store"});
    if(!r.ok) throw new Error(r.status);
    const data = await r.json();
    let src = data.icestats.source;
    if(Array.isArray(src)) src = src.find(s=>s.listenurl.endsWith("/stream"))||src[0];
    const rawTitle  = src.title || "Titre inconnu";
    const listeners = src.listeners ?? 0;

    titleEl.textContent = rawTitle;
    listenersEl.textContent = "AuditeursÂ :Â "+listeners;

    if(rawTitle !== lastTitle && rawTitle!=="Titre inconnu"){
      lastTitle = rawTitle;
      // Essaye de sÃ©parer "Artiste - Titre"
      let query = rawTitle.split(" - ").slice(0,2).join(" ");
      fetchCover(query);
    }
  }catch(e){
    titleEl.textContent = "Flux indisponibleâ€¦";
    listenersEl.textContent = "";
    coverImg.src = "https://dummyimage.com/600x600/1b1b1b/ffffff&text=Z+Radio";
  }
}
player.addEventListener("play",()=>{ refresh(); setInterval(refresh,15000); },{once:true});
</script>

</body>
</html>
