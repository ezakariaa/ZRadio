<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>ZÂ Radio â€“Â LiveÂ Stream</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <!-- ð—¦ð˜ð˜†ð—¹ð—² minimal -->
  <style>
    :root{
      --bg:#111;--fg:#f5f5f5;--accent:#1db954;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      display:flex;flex-direction:column;justify-content:center;align-items:center;
      min-height:100vh;background:var(--bg);color:var(--fg);
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;
      text-align:center;padding:1.2rem;
    }
    h1{margin:0 0 .25em;font-size:2.4rem;color:var(--accent)}
    small{color:#aaa}
    audio{width:100%;max-width:420px;margin:1.4em 0}
    #nowPlaying{margin-top:.8em;font-size:1.05rem;min-height:1.4em}
    a{color:var(--accent)}
    footer{margin-top:2.5rem;font-size:.8rem;color:#666}
  </style>
</head>
<body>

  <h1>ðŸŽµÂ ZÂ Radio</h1>
  <small>MusiqueÂ 24Â /Â 7 â€“Â IcecastÂ Stream</small>

  <!-- ð—Ÿð—²ð—°ð˜ð—²ð˜‚ð—¿ -->
  <audio id="player" controls preload="none">
    <source src="//zradio.ddns.net:8443/stream" type="audio/mpeg">
    Votre navigateur ne supporte pas lâ€™audioÂ HTML5.
  </audio>

  <!-- ð— ð—²ð˜ð—®ð—±ð—¼ð—»ð—»ð—²Ìð—²ð˜€ dynamiques -->
  <div id="nowPlaying">Chargementâ€¦</div>

  <script>
    /* URLs sans schÃ©maÂ : http ou https selon la page */
    const statusURL = "//zradio.ddns.net:8443/status-json.xsl";
    const nowPlaying = document.getElementById("nowPlaying");
    const player = document.getElementById("player");

    async function refresh() {
      try {
        const r = await fetch(statusURL);
        if (!r.ok) throw new Error(r.status);
        const data = await r.json();

        let src = data.icestats.source;
        if (Array.isArray(src)) {
          src = src.find(s => s.listenurl.endsWith("/stream")) || src[0];
        }
        const title = src.title || "Titre inconnu";
        const listeners = src.listeners ?? 0;
        nowPlaying.textContent = `ðŸŽ¶Â ${title}Â Â Â ðŸ‘¥Â AuditeursÂ :Â ${listeners}`;
      } catch (e) {
        nowPlaying.textContent = "Flux indisponibleâ€¦";
      }
    }

    /* Lance la boucle de rafraÃ®chissement uniquement quand lâ€™utilisateur lit le flux
       (Ã©vite les requÃªtes bloquÃ©es avant autorisation de contenu mixte) */
    let refreshInterval;
    player.addEventListener("play", () => {
      refresh();                       // 1Ê³áµ‰ mise Ã  jour immÃ©diate
      refreshInterval = setInterval(refresh, 15000);
    });
    player.addEventListener("pause", () => clearInterval(refreshInterval));
  </script>

  <footer>
    Â©Â 2025Â <span style="color:var(--accent)">ZÂ Radio</span> â€“Â Powered by
    <a href="https://icecast.org" target="_blank" rel="noopener">IcecastÂ 2</a>
  </footer>

</body>
</html>
