<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Z Radio – Live Stream</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <!-- 𝗦𝘁𝘆𝗹𝗲 minimal -->
  <style>
    :root{
      --bg:#111;--fg:#f5f5f5;--accent:#1db954;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      display:flex;flex-direction:column;justify-content:center;align-items:center;
      min-height:100vh;background:var(--bg);color:var(--fg);
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;
      text-align:center;padding:1.2rem;
    }
    h1{margin:0 0 .25em;font-size:2.4rem;color:var(--accent)}
    small{color:#aaa}
    audio{width:100%;max-width:420px;margin:1.4em 0}
    #nowPlaying{margin-top:.8em;font-size:1.05rem;min-height:1.4em}
    a{color:var(--accent)}
    footer{margin-top:2.5rem;font-size:.8rem;color:#666}
  </style>
</head>
<body>

  <h1>🎵 Z Radio</h1>
  <small>Musique 24 / 7 – Icecast Stream</small>

  <!-- 𝗟𝗲𝗰𝘁𝗲𝘂𝗿 -->
  <audio id="player" controls preload="none">
    <source src="//zradio.ddns.net:8443/stream" type="audio/mpeg">
    Votre navigateur ne supporte pas l’audio HTML5.
  </audio>

  <!-- 𝗠𝗲𝘁𝗮𝗱𝗼𝗻𝗻𝗲́𝗲𝘀 dynamiques -->
  <div id="nowPlaying">Chargement…</div>

  <script>
    /* URLs sans schéma : http ou https selon la page */
    const statusURL = "//zradio.ddns.net:8443/status-json.xsl";
    const nowPlaying = document.getElementById("nowPlaying");
    const player = document.getElementById("player");

    async function refresh() {
      try {
        const r = await fetch(statusURL);
        if (!r.ok) throw new Error(r.status);
        const data = await r.json();

        let src = data.icestats.source;
        if (Array.isArray(src)) {
          src = src.find(s => s.listenurl.endsWith("/stream")) || src[0];
        }
        const title = src.title || "Titre inconnu";
        const listeners = src.listeners ?? 0;
        nowPlaying.textContent = `🎶 ${title}   👥 Auditeurs : ${listeners}`;
      } catch (e) {
        nowPlaying.textContent = "Flux indisponible…";
      }
    }

    /* Lance la boucle de rafraîchissement uniquement quand l’utilisateur lit le flux
       (évite les requêtes bloquées avant autorisation de contenu mixte) */
    let refreshInterval;
    player.addEventListener("play", () => {
      refresh();                       // 1ʳᵉ mise à jour immédiate
      refreshInterval = setInterval(refresh, 15000);
    });
    player.addEventListener("pause", () => clearInterval(refreshInterval));
  </script>

  <footer>
    © 2025 <span style="color:var(--accent)">Z Radio</span> – Powered by
    <a href="https://icecast.org" target="_blank" rel="noopener">Icecast 2</a>
  </footer>

</body>
</html>
